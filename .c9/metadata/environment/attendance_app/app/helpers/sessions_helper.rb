{"filter":false,"title":"sessions_helper.rb","tooltip":"/attendance_app/app/helpers/sessions_helper.rb","undoManager":{"mark":52,"position":52,"stack":[[{"start":{"row":0,"column":21},"end":{"row":1,"column":0},"action":"insert","lines":["",""],"id":4},{"start":{"row":1,"column":0},"end":{"row":1,"column":2},"action":"insert","lines":["  "]},{"start":{"row":1,"column":2},"end":{"row":2,"column":0},"action":"insert","lines":["",""]},{"start":{"row":2,"column":0},"end":{"row":2,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":2,"column":2},"end":{"row":4,"column":31},"action":"insert","lines":[" # 引数に渡されたユーザーオブジェクトでログインします。","  def log_in(user)","    session[:user_id] = user.id"],"id":5}],[{"start":{"row":4,"column":31},"end":{"row":5,"column":0},"action":"insert","lines":["",""],"id":6},{"start":{"row":5,"column":0},"end":{"row":5,"column":4},"action":"insert","lines":["    "]},{"start":{"row":5,"column":4},"end":{"row":5,"column":5},"action":"insert","lines":["e"]},{"start":{"row":5,"column":5},"end":{"row":5,"column":6},"action":"insert","lines":["n"]},{"start":{"row":5,"column":6},"end":{"row":5,"column":7},"action":"insert","lines":["d"]},{"start":{"row":5,"column":2},"end":{"row":5,"column":4},"action":"remove","lines":["  "]}],[{"start":{"row":5,"column":5},"end":{"row":6,"column":0},"action":"insert","lines":["",""],"id":7},{"start":{"row":6,"column":0},"end":{"row":6,"column":2},"action":"insert","lines":["  "]},{"start":{"row":6,"column":2},"end":{"row":7,"column":0},"action":"insert","lines":["",""]},{"start":{"row":7,"column":0},"end":{"row":7,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":7,"column":2},"end":{"row":16,"column":0},"action":"insert","lines":["def current_user","  if session[:user_id]","    if @current_user.nil?","      @current_user = User.find_by(id: session[:user_id])","    else","      @current_user","    end","  end","end",""],"id":8}],[{"start":{"row":8,"column":0},"end":{"row":8,"column":2},"action":"insert","lines":["  "],"id":9},{"start":{"row":9,"column":0},"end":{"row":9,"column":2},"action":"insert","lines":["  "]},{"start":{"row":10,"column":0},"end":{"row":10,"column":2},"action":"insert","lines":["  "]},{"start":{"row":11,"column":0},"end":{"row":11,"column":2},"action":"insert","lines":["  "]},{"start":{"row":12,"column":0},"end":{"row":12,"column":2},"action":"insert","lines":["  "]},{"start":{"row":13,"column":0},"end":{"row":13,"column":2},"action":"insert","lines":["  "]},{"start":{"row":14,"column":0},"end":{"row":14,"column":2},"action":"insert","lines":["  "]},{"start":{"row":15,"column":0},"end":{"row":15,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":15,"column":5},"end":{"row":16,"column":0},"action":"remove","lines":["",""],"id":10}],[{"start":{"row":6,"column":2},"end":{"row":7,"column":0},"action":"insert","lines":["",""],"id":11},{"start":{"row":7,"column":0},"end":{"row":7,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":7,"column":2},"end":{"row":7,"column":34},"action":"insert","lines":[" # 現在ログイン中のユーザーがいる場合オブジェクトを返します。"],"id":12}],[{"start":{"row":16,"column":5},"end":{"row":17,"column":0},"action":"insert","lines":["",""],"id":13},{"start":{"row":17,"column":0},"end":{"row":17,"column":2},"action":"insert","lines":["  "]},{"start":{"row":17,"column":2},"end":{"row":18,"column":0},"action":"insert","lines":["",""]},{"start":{"row":18,"column":0},"end":{"row":18,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":18,"column":2},"end":{"row":21,"column":5},"action":"insert","lines":["# 現在ログイン中のユーザーがいればtrue、そうでなければfalseを返します。","  def logged_in?","    !current_user.nil?","  end"],"id":14}],[{"start":{"row":5,"column":5},"end":{"row":6,"column":0},"action":"insert","lines":["",""],"id":16},{"start":{"row":6,"column":0},"end":{"row":6,"column":2},"action":"insert","lines":["  "]},{"start":{"row":6,"column":2},"end":{"row":7,"column":0},"action":"insert","lines":["",""]},{"start":{"row":7,"column":0},"end":{"row":7,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":7,"column":2},"end":{"row":11,"column":5},"action":"insert","lines":["  # セッションと@current_userを破棄します","  def log_out","    session.delete(:user_id)","    @current_user = nil","  end"],"id":17}],[{"start":{"row":5,"column":5},"end":{"row":6,"column":0},"action":"insert","lines":["",""],"id":18},{"start":{"row":6,"column":0},"end":{"row":6,"column":2},"action":"insert","lines":["  "]},{"start":{"row":6,"column":2},"end":{"row":7,"column":0},"action":"insert","lines":["",""]},{"start":{"row":7,"column":0},"end":{"row":7,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":7,"column":2},"end":{"row":12,"column":5},"action":"insert","lines":[" # 永続的セッションを記憶します（Userモデルを参照）","  def remember(user)","    user.remember","    cookies.permanent.signed[:user_id] = user.id","    cookies.permanent[:remember_token] = user.remember_token","  end"],"id":19}],[{"start":{"row":7,"column":2},"end":{"row":7,"column":3},"action":"remove","lines":[" "],"id":20}],[{"start":{"row":20,"column":1},"end":{"row":29,"column":5},"action":"remove","lines":["  # 現在ログイン中のユーザーがいる場合オブジェクトを返します。","  def current_user","    if session[:user_id]","      if @current_user.nil?","        @current_user = User.find_by(id: session[:user_id])","      else","        @current_user","      end","    end","  end"],"id":21},{"start":{"row":20,"column":1},"end":{"row":32,"column":5},"action":"insert","lines":["# 一時的セッションにいるユーザーを返します。","  # それ以外の場合はcookiesに対応するユーザーを返します。","  def current_user","    if (user_id = session[:user_id])","      @current_user ||= User.find_by(id: user_id)","    elsif (user_id = cookies.signed[:user_id])","      user = User.find_by(id: user_id)","      if user && user.authenticated?(cookies[:remember_token])","        log_in user","        @current_user = user","      end","    end","  end"]}],[{"start":{"row":20,"column":1},"end":{"row":20,"column":2},"action":"insert","lines":[" "],"id":22}],[{"start":{"row":12,"column":5},"end":{"row":13,"column":0},"action":"insert","lines":["",""],"id":23},{"start":{"row":13,"column":0},"end":{"row":13,"column":2},"action":"insert","lines":["  "]},{"start":{"row":13,"column":2},"end":{"row":14,"column":0},"action":"insert","lines":["",""]},{"start":{"row":14,"column":0},"end":{"row":14,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":14,"column":2},"end":{"row":19,"column":5},"action":"insert","lines":["  # 永続的セッションを破棄します","  def forget(user)","    user.forget # Userモデル参照","    cookies.delete(:user_id)","    cookies.delete(:remember_token)","  end"],"id":24}],[{"start":{"row":14,"column":2},"end":{"row":14,"column":4},"action":"remove","lines":["  "],"id":25}],[{"start":{"row":21,"column":2},"end":{"row":21,"column":4},"action":"remove","lines":["  "],"id":26}],[{"start":{"row":21,"column":2},"end":{"row":25,"column":5},"action":"remove","lines":["# セッションと@current_userを破棄します","  def log_out","    session.delete(:user_id)","    @current_user = nil","  end"],"id":27},{"start":{"row":21,"column":2},"end":{"row":25,"column":5},"action":"insert","lines":["# セッションと@current_userを破棄します","  def log_out","    session.delete(:user_id)","    @current_user = nil","  end"]}],[{"start":{"row":21,"column":2},"end":{"row":25,"column":5},"action":"remove","lines":["# セッションと@current_userを破棄します","  def log_out","    session.delete(:user_id)","    @current_user = nil","  end"],"id":28},{"start":{"row":21,"column":2},"end":{"row":26,"column":5},"action":"insert","lines":["# セッションと@current_userを破棄します","  def log_out","    forget(current_user)","    session.delete(:user_id)","    @current_user = nil","  end"]}],[{"start":{"row":0,"column":0},"end":{"row":47,"column":0},"action":"remove","lines":["module SessionsHelper","  ","   # 引数に渡されたユーザーオブジェクトでログインします。","  def log_in(user)","    session[:user_id] = user.id","  end","  ","  # 永続的セッションを記憶します（Userモデルを参照）","  def remember(user)","    user.remember","    cookies.permanent.signed[:user_id] = user.id","    cookies.permanent[:remember_token] = user.remember_token","  end","  ","  # 永続的セッションを破棄します","  def forget(user)","    user.forget # Userモデル参照","    cookies.delete(:user_id)","    cookies.delete(:remember_token)","  end","  ","  # セッションと@current_userを破棄します","  def log_out","    forget(current_user)","    session.delete(:user_id)","    @current_user = nil","  end","  ","  # 一時的セッションにいるユーザーを返します。","  # それ以外の場合はcookiesに対応するユーザーを返します。","  def current_user","    if (user_id = session[:user_id])","      @current_user ||= User.find_by(id: user_id)","    elsif (user_id = cookies.signed[:user_id])","      user = User.find_by(id: user_id)","      if user && user.authenticated?(cookies[:remember_token])","        log_in user","        @current_user = user","      end","    end","  end","  ","  # 現在ログイン中のユーザーがいればtrue、そうでなければfalseを返します。","  def logged_in?","    !current_user.nil?","  end","end",""],"id":29},{"start":{"row":0,"column":0},"end":{"row":31,"column":3},"action":"insert","lines":["module SessionsHelper","","  # 引数に渡されたユーザーオブジェクトでログインします。","  def log_in(user)","    session[:user_id] = user.id","  end","","  # 永続的セッションを記憶します（Userモデルを参照）","  def remember(user)","    user.remember","    cookies.permanent.signed[:user_id] = user.id","    cookies.permanent[:remember_token] = user.remember_token","  end","","  # セッションと@current_userを破棄します","  def log_out","    session.delete(:user_id)","    @current_user = nil","  end","","  # 現在ログイン中のユーザーがいる場合オブジェクトを返します。","  def current_user","    if session[:user_id]","      @current_user ||= User.find_by(id: session[:user_id])","    end","  end","","  # 現在ログイン中のユーザーがいればtrue、そうでなければfalseを返します。","  def logged_in?","    !current_user.nil?","  end","end"]}],[{"start":{"row":0,"column":0},"end":{"row":31,"column":3},"action":"remove","lines":["module SessionsHelper","","  # 引数に渡されたユーザーオブジェクトでログインします。","  def log_in(user)","    session[:user_id] = user.id","  end","","  # 永続的セッションを記憶します（Userモデルを参照）","  def remember(user)","    user.remember","    cookies.permanent.signed[:user_id] = user.id","    cookies.permanent[:remember_token] = user.remember_token","  end","","  # セッションと@current_userを破棄します","  def log_out","    session.delete(:user_id)","    @current_user = nil","  end","","  # 現在ログイン中のユーザーがいる場合オブジェクトを返します。","  def current_user","    if session[:user_id]","      @current_user ||= User.find_by(id: session[:user_id])","    end","  end","","  # 現在ログイン中のユーザーがいればtrue、そうでなければfalseを返します。","  def logged_in?","    !current_user.nil?","  end","end"],"id":30},{"start":{"row":0,"column":0},"end":{"row":39,"column":0},"action":"insert","lines":["module SessionsHelper","","  # 引数に渡されたユーザーオブジェクトでログインします。","  def log_in(user)","    session[:user_id] = user.id","  end","","  # 永続的セッションを記憶します（Userモデルを参照）","  def remember(user)","    user.remember","    cookies.permanent.signed[:user_id] = user.id","    cookies.permanent[:remember_token] = user.remember_token","  end","","  # セッションと@current_userを破棄します","  def log_out","    session.delete(:user_id)","    @current_user = nil","  end","","  # 一時的セッションにいるユーザーを返します。","  # それ以外の場合はcookiesに対応するユーザーを返します。","  def current_user","    if (user_id = session[:user_id])","      @current_user ||= User.find_by(id: user_id)","    elsif (user_id = cookies.signed[:user_id])","      user = User.find_by(id: user_id)","      if user && user.authenticated?(cookies[:remember_token])","        log_in user","        @current_user = user","      end","    end","  end","","  # 現在ログイン中のユーザーがいればtrue、そうでなければfalseを返します。","  def logged_in?","    !current_user.nil?","  end","end",""]}],[{"start":{"row":0,"column":0},"end":{"row":39,"column":0},"action":"remove","lines":["module SessionsHelper","","  # 引数に渡されたユーザーオブジェクトでログインします。","  def log_in(user)","    session[:user_id] = user.id","  end","","  # 永続的セッションを記憶します（Userモデルを参照）","  def remember(user)","    user.remember","    cookies.permanent.signed[:user_id] = user.id","    cookies.permanent[:remember_token] = user.remember_token","  end","","  # セッションと@current_userを破棄します","  def log_out","    session.delete(:user_id)","    @current_user = nil","  end","","  # 一時的セッションにいるユーザーを返します。","  # それ以外の場合はcookiesに対応するユーザーを返します。","  def current_user","    if (user_id = session[:user_id])","      @current_user ||= User.find_by(id: user_id)","    elsif (user_id = cookies.signed[:user_id])","      user = User.find_by(id: user_id)","      if user && user.authenticated?(cookies[:remember_token])","        log_in user","        @current_user = user","      end","    end","  end","","  # 現在ログイン中のユーザーがいればtrue、そうでなければfalseを返します。","  def logged_in?","    !current_user.nil?","  end","end",""],"id":31},{"start":{"row":0,"column":0},"end":{"row":46,"column":3},"action":"insert","lines":["module SessionsHelper","","  # 引数に渡されたユーザーオブジェクトでログインします。","  def log_in(user)","    session[:user_id] = user.id","  end","","  # 永続的セッションを記憶します（Userモデルを参照）","  def remember(user)","    user.remember","    cookies.permanent.signed[:user_id] = user.id","    cookies.permanent[:remember_token] = user.remember_token","  end","","  # 永続的セッションを破棄します","  def forget(user)","    user.forget # Userモデル参照","    cookies.delete(:user_id)","    cookies.delete(:remember_token)","  end","","  # セッションと@current_userを破棄します","  def log_out","    forget(current_user)","    session.delete(:user_id)","    @current_user = nil","  end","","  # 一時的セッションにいるユーザーを返します。","  # それ以外の場合はcookiesに対応するユーザーを返します。","  def current_user","    if (user_id = session[:user_id])","      @current_user ||= User.find_by(id: user_id)","    elsif (user_id = cookies.signed[:user_id])","      user = User.find_by(id: user_id)","      if user && user.authenticated?(cookies[:remember_token])","        log_in user","        @current_user = user","      end","    end","  end","","  # 現在ログイン中のユーザーがいればtrue、そうでなければfalseを返します。","  def logged_in?","    !current_user.nil?","  end","end"]}],[{"start":{"row":35,"column":4},"end":{"row":35,"column":6},"action":"remove","lines":["  "],"id":32}],[{"start":{"row":36,"column":6},"end":{"row":36,"column":7},"action":"remove","lines":[" "],"id":33}],[{"start":{"row":37,"column":4},"end":{"row":37,"column":6},"action":"remove","lines":["  "],"id":34}],[{"start":{"row":38,"column":4},"end":{"row":38,"column":5},"action":"insert","lines":[" "],"id":35}],[{"start":{"row":38,"column":4},"end":{"row":38,"column":5},"action":"remove","lines":[" "],"id":36},{"start":{"row":38,"column":2},"end":{"row":38,"column":4},"action":"remove","lines":["  "]}],[{"start":{"row":37,"column":0},"end":{"row":37,"column":2},"action":"remove","lines":["  "],"id":37}],[{"start":{"row":30,"column":1},"end":{"row":40,"column":5},"action":"remove","lines":[" def current_user","    if (user_id = session[:user_id])","      @current_user ||= User.find_by(id: user_id)","    elsif (user_id = cookies.signed[:user_id])","      user = User.find_by(id: user_id)","    if user && user.authenticated?(cookies[:remember_token])","       log_in user","    @current_user = user","    end","    end","  end"],"id":43},{"start":{"row":30,"column":1},"end":{"row":40,"column":5},"action":"insert","lines":["  def current_user","    if (user_id = session[:user_id])","      @current_user ||= User.find_by(id: user_id)","    elsif (user_id = cookies.signed[:user_id])","      user = User.find_by(id: user_id)","      if user && user.authenticated?(cookies[:remember_token])","        log_in user","        @current_user = user","      end","    end","  end"]}],[{"start":{"row":40,"column":5},"end":{"row":40,"column":6},"action":"insert","lines":[" "],"id":44}],[{"start":{"row":40,"column":2},"end":{"row":40,"column":3},"action":"insert","lines":[" "],"id":45}],[{"start":{"row":2,"column":2},"end":{"row":5,"column":5},"action":"remove","lines":["# 引数に渡されたユーザーオブジェクトでログインします。","  def log_in(user)","    session[:user_id] = user.id","  end"],"id":46},{"start":{"row":2,"column":2},"end":{"row":5,"column":5},"action":"insert","lines":["# 引数に渡されたユーザーオブジェクトでログインします。","  def log_in(user)","    session[:user_id] = user.id","  end"]}],[{"start":{"row":29,"column":3},"end":{"row":40,"column":7},"action":"remove","lines":[" それ以外の場合はcookiesに対応するユーザーを返します。","   def current_user","    if (user_id = session[:user_id])","      @current_user ||= User.find_by(id: user_id)","    elsif (user_id = cookies.signed[:user_id])","      user = User.find_by(id: user_id)","      if user && user.authenticated?(cookies[:remember_token])","        log_in user","        @current_user = user","      end","    end","   end "],"id":47},{"start":{"row":29,"column":3},"end":{"row":34,"column":5},"action":"insert","lines":["  # 現在ログイン中のユーザーがいる場合オブジェクトを返します。","  def current_user","    if session[:user_id]","      @current_user ||= User.find_by(id: session[:user_id])","    end","  end"]}],[{"start":{"row":29,"column":4},"end":{"row":29,"column":5},"action":"remove","lines":[" "],"id":49},{"start":{"row":29,"column":3},"end":{"row":29,"column":4},"action":"remove","lines":[" "]},{"start":{"row":29,"column":2},"end":{"row":29,"column":3},"action":"remove","lines":["#"]}],[{"start":{"row":28,"column":1},"end":{"row":28,"column":25},"action":"remove","lines":[" # 一時的セッションにいるユーザーを返します。"],"id":50}],[{"start":{"row":29,"column":1},"end":{"row":34,"column":5},"action":"remove","lines":[" # 現在ログイン中のユーザーがいる場合オブジェクトを返します。","  def current_user","    if session[:user_id]","      @current_user ||= User.find_by(id: session[:user_id])","    end","  end"],"id":51},{"start":{"row":29,"column":1},"end":{"row":41,"column":5},"action":"insert","lines":[" # 一時的セッションにいるユーザーを返します。","  # それ以外の場合はcookiesに対応するユーザーを返します。","  def current_user","    if (user_id = session[:user_id])","      @current_user ||= User.find_by(id: user_id)","    elsif (user_id = cookies.signed[:user_id])","      user = User.find_by(id: user_id)","      if user && user.authenticated?(cookies[:remember_token])","        log_in user","        @current_user = user","      end","    end","  end"]}],[{"start":{"row":12,"column":5},"end":{"row":13,"column":0},"action":"insert","lines":["",""],"id":52},{"start":{"row":13,"column":0},"end":{"row":13,"column":2},"action":"insert","lines":["  "]},{"start":{"row":13,"column":2},"end":{"row":14,"column":0},"action":"insert","lines":["",""]},{"start":{"row":14,"column":0},"end":{"row":14,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":14,"column":2},"end":{"row":19,"column":0},"action":"insert","lines":["def remember(user)","  user.remember # remember_tokenの生成と保存","  cookies.permanent.signed[:user_id] = user.id","  cookies.permanent[:remember_token] = user.remember_token","end",""],"id":53}],[{"start":{"row":15,"column":0},"end":{"row":15,"column":2},"action":"insert","lines":["  "],"id":54},{"start":{"row":16,"column":0},"end":{"row":16,"column":2},"action":"insert","lines":["  "]},{"start":{"row":17,"column":0},"end":{"row":17,"column":2},"action":"insert","lines":["  "]},{"start":{"row":18,"column":0},"end":{"row":18,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":8,"column":0},"end":{"row":14,"column":1},"action":"remove","lines":["  def remember(user)","    user.remember","    cookies.permanent.signed[:user_id] = user.id","    cookies.permanent[:remember_token] = user.remember_token","  end","  "," "],"id":55}],[{"start":{"row":8,"column":0},"end":{"row":8,"column":1},"action":"insert","lines":["　"],"id":56}],[{"start":{"row":8,"column":0},"end":{"row":8,"column":1},"action":"remove","lines":["　"],"id":57}],[{"start":{"row":8,"column":0},"end":{"row":8,"column":1},"action":"insert","lines":[" "],"id":58}],[{"start":{"row":47,"column":5},"end":{"row":48,"column":0},"action":"insert","lines":["",""],"id":60},{"start":{"row":48,"column":0},"end":{"row":48,"column":2},"action":"insert","lines":["  "]},{"start":{"row":48,"column":2},"end":{"row":49,"column":0},"action":"insert","lines":["",""]},{"start":{"row":49,"column":0},"end":{"row":49,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":49,"column":2},"end":{"row":59,"column":3},"action":"insert","lines":["  # 記憶しているURL(またはデフォルトURL)にリダイレクトします。","  def redirect_back_or(default_url)","    redirect_to(session[:forwarding_url] || default_url)","    session.delete(:forwarding_url)","  end","","  # アクセスしようとしたURLを記憶します。","  def store_location","    session[:forwarding_url] = request.original_url if request.get?","  end","end"],"id":61}],[{"start":{"row":59,"column":2},"end":{"row":59,"column":3},"action":"remove","lines":["d"],"id":62},{"start":{"row":59,"column":1},"end":{"row":59,"column":2},"action":"remove","lines":["n"]},{"start":{"row":59,"column":0},"end":{"row":59,"column":1},"action":"remove","lines":["e"]},{"start":{"row":58,"column":5},"end":{"row":59,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":49,"column":2},"end":{"row":49,"column":4},"action":"remove","lines":["  "],"id":63}],[{"start":{"row":49,"column":1},"end":{"row":54,"column":0},"action":"remove","lines":[" # 記憶しているURL(またはデフォルトURL)にリダイレクトします。","  def redirect_back_or(default_url)","    redirect_to(session[:forwarding_url] || default_url)","    session.delete(:forwarding_url)","  end",""],"id":64},{"start":{"row":49,"column":0},"end":{"row":49,"column":1},"action":"remove","lines":[" "]},{"start":{"row":48,"column":2},"end":{"row":49,"column":0},"action":"remove","lines":["",""]}]]},"ace":{"folds":[],"scrolltop":685.9294921874998,"scrollleft":0,"selection":{"start":{"row":53,"column":3},"end":{"row":53,"column":3},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":14,"state":"start","mode":"ace/mode/ruby"}},"timestamp":1690451061085,"hash":"0c7c905646780764c7508b9ae38c54c4b64c7cac"}